This is VERMONT - VERsatile MONitoring Tool.
IPFIX/PSAMP probe
Released under GPL2, no guarantees, no warranty


REQUIREMENTS

Decent and recent gcc compiler w/ C++ support (there are some gcc-isms)
libpcap
*nix (Linux and recent FreeBSD preferred, other untested)


INSTALLATION

You have to create a configure script first. This can be done with the
script build-configure.sh. You need to install the autotools in order to
create the configure script.
I used aclocal-1.7.9, autoconf-2.60 and automake-1.7.9 to create the script.
Other versions might work as well, but aren't tested yet.

After you created the configure script run

$ ./configure
$ make


CONFIGURATION

Packaged comes a commented test.xml file. See file CONFIGURATION for more
information.


SAMPLER

Does packet sampling, reads raw packet data from an interface, put them thru
a filtering mechanism and finally export matching packets to an PSAMP/IPFIX 
collector.


CONCENTRATOR

Reads IPFIX/Netflow data from socket, aggregates data for certain flows, 
exports this data again via IPFIX.


THE HOOK

You can configure VERMONT to inject SAMPLER's captured packets into the
CONCENTRATOR for aggregation and export. Config option is in section main,
value packets.


NOTES ON MONITORING PORTS

Some switches add an additional field VLAN with size 4Bytes.
So you have to adjust the pcap_expression to "vlan and ip".
Futhermore, the Packet::IPHeaderOffset has to adjusted to 18.


NOTES ON THREADS

When threads are to be exited, their real exit is waited for using 
pthread_join().
This may lock for a while because I/O from sockets etc. is done in blocking
mode, so when no packet arrives, the thread will block in read().
You may want to rewrite the Thread class to do a pthread_detach() instread and
grep for further occurences of pthread_join().


APPENDIX

faster Linux MMAP()ed PCAP: http://public.lanl.gov/cpw/

